---
__extend: skeleton

build:
  cmds:
    - cd [% root.scm.repos.0.name %]
    - virtualenv -p [% root.vars.interpreter %] .
    - source ./bin/activate
    - "[% root.vars.pip %] install -r ./requirement.txt"
    - deactivate
    - perl -i -pE 's|(VIRTUAL_ENV=\").*(\")|${1}[% root.deploy.locations.0 %]/[% root.vca.appName %]${2}|' ./bin/activate

package:
  includes:
    - "*"

deploy:
  owner: apache
  group: apache
  mode: 755

  instance:
    post:
      - touch [% root.deploy.locations.0 %]/[% root.vca.appName %]/config/wsgi.py
